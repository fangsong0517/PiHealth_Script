# PiHealth_Script
[![](https://img.shields.io/github/issues/fangsong0517/PiHealth_Script.svg)](https://github.com/fangsong0517/PiHealth_Script/issues)  [![](https://img.shields.io/github/forks/fangsong0517/PiHealth_Script.svg)](https://github.com/fangsong0517/PiHealth_Script/network) [![](https://img.shields.io/github/stars/fangsong0517/PiHealth_Script.svg)](https://github.com/fangsong0517/PiHealth_Script/stargazers) 

分布式集群监控系统



## 目录



* [CPU信息获取](#CPU信息获取)

* [内存信息获取](#内存信息获取)

* [磁盘信息获取](磁盘信息获取)

* [用户信息的获取](用户信息的获取)

* [系统信息获取](系统信息获取)

* [进程信息获取](进程信息获取)



## CPU信息获取

准备知识：

1.`/proc`文件系统是一个为文件系统，该文件系统中存储着内核控制相关的信息，通俗来说就是这个目录是虚拟的，它受内核直接控制，存储域内核相关的数据，与其他目录不同的是/proc的目录不是真实存储在硬盘中的，他的数据存储在内核中，但是由于它和其他目录一样把自己注册到虚拟系统层中，所以我们还是能看到这个目录相关信息，然而只有虚拟文件系统调用它时后，他才会建立相关和目录并与内核相沟通获取喜爱相关信息。

2.上面我们说道/proc文件系统存储这内核相关信息的目录，该目录下的/proc/stat文件存储的就是CPU先关信息，我们要想获取CPU相关信息的最直接方法就是读取该文件，其实LINUX下的很多工具我们都是读取这个文件。在这个文件中包含了所有的CPU信息活动，并且该文件中所有制都是从系统启动算起知道访问系统启动算起直到访问文件的这一刻起的数据。如下就是磨一时刻/proc/stat文件的数据:

```shell
cpu  2923678 13826 901416 18404419 348295 0 382445 0 0 0
cpu0 367754 2019 96824 2322198 34885 0 134902 0 0 0
cpu1 364148 1376 200289 2229749 24979 0 8036 0 0 0
cpu2 376990 1676 93784 2327959 26732 0 86446 0 0 0
cpu3 373802 1718 94566 2275900 79983 0 61243 0 0 0
cpu4 371609 2186 94644 2305660 54508 0 41274 0 0 0
cpu5 359088 1550 113516 2302787 46496 0 8980 0 0 0
cpu6 358635 1632 96844 2315176 45670 0 20794 0 0 0
cpu7 351649 1667 110945 2324986 35038 0 20767 0 0 0
intr 118128100 7 27 0 0 0 0 0 0 1 36182 0 0 3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 546878 490929 22 0 2796 9143625 39 4474345 4471 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
ctxt 352517171
btime 1588666366
processes 72168
procs_running 4
procs_blocked 0
softirq 120000675 7046615 39084156 82 10050 496767 0 23050 45525758 3363 27810834
```

2.1如上数据中cpu到cpu7(从左往右顺序依次是):

(1). user: 如上2923678、367754、364148等,用户态时间

(2). nice: 如上13826等第二列数据, nice 值为负值的进程所用时间

(3).system: 如上第三列数据，核心时间

(4).idle: 入上第四列数据，除硬盘IO等待时间之外的时间

(5).iowait:入上第五列数据，硬盘IO等待时间

(6).irq:挼还是那个第六列数据，硬中断时间

(7).softirq如上第七列数据，软中断时间


$$
CPU_{time} = user_{line1}+nice_{line2}+system_{line3}+idle_{line4} + iowait_{line5}+irq_{line6}+sortirq_{line7}
$$

2.2剩下的几行：

> 		  　　initr:中断次数
> 		  ctxt:交换次数
> 		  btime: 从系统启动到访问文件为止的时间
> 		  process:任务数
> 		  procs_runing:当前运行队列的任务数
> 		  procs_blocked:当前被阻塞的任务数

2.3 CPU利用率计算可以采用两点采样取差值方式
$$
CPU_{usage} = (idle_{第二次采样}-idle_{第一次采样})/(CPU_{time第二次采样}-CPU_{time第一次采样})*100
$$
3.CPU温度的获取

cpu温度存储在`/sys/class/thermal/thermal_zone0/temp`中，读取出的数值需要除以100

4.bash工具:

 	1.`cat`:工具用来强制读取一个文件
 	2.`gerp`:工具用来筛选数据
 	3.`awk`:用来处理数据
 	4.`uptime`:获取cpu负载信息



## 内存信息获取

* `free`: 获取内存信息
* grep:该工具用来筛选数据
* `awk`：改工具用来处理数据

## 磁盘信息获取

* 知识准备

  1.`df`:该工具用来获取文件系统挂载信息

  2.`awk`:处理`df`的数据

## 用户信息的获取

* 知识准备

1. `w`：获取当前登录信息
2. `grep`：对数据进行筛选
3. `cut`：对字符串进行剪切
4. `sort`：排序
5. `uniq`：统计每个字符串个数
6. `head`：显示开头几行
7. `awk`：文本处理工具

## 系统信息获取



* 知识准备

1. `date`：获取当前时间
2. `/etc/issue`：系统版本信息
3. `/proc/loadavg`：负载信息
4. `df`：获取磁盘信息
5. `free`：内存信息
6. `/sys/class/thermal/thermal_zone0/temp`：cpu温度
7. `hostname`：主机名

## 进程信息获取

知识准备：

1. `ps` 该工具用来获取进程信息
2. `awk`该工具用来处理数据

